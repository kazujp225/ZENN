# ğŸ” ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

## ğŸš¨ **ç·Šæ€¥å¯¾å¿œå¿…é ˆé …ç›®**

### 1. **èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…** (æœ€å„ªå…ˆ)
- [x] Supabase Auth ã®å®Ÿè£…
- [x] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ– (Supabaseã§è‡ªå‹•å‡¦ç†)
- [x] JWT ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† (Supabaseã§è‡ªå‹•å‡¦ç†)
- [ ] ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°åˆ¶é™

### 2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** (æœ€å„ªå…ˆ)
- [x] RLS (Row Level Security) ãƒãƒªã‚·ãƒ¼ã®å®Ÿè£… (SQLãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ¸ˆã¿)
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã®é©åˆ‡ãªè¨­å®š
- [x] å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®ç¢ºèª
- [x] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã®æœ€å°åŒ–

### 3. **API ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** (æœ€å„ªå…ˆ)
- [ ] å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«èªè¨¼æ©Ÿèƒ½è¿½åŠ 
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
- [ ] ç®¡ç†ç”¨APIã®å‰Šé™¤ã¾ãŸã¯ä¿è­·
- [ ] CORSè¨­å®šã®é©åˆ‡ãªåˆ¶é™

### 4. **ç®¡ç†ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‰Šé™¤/ä¿è­·**
```
âœ… ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ç„¡åŠ¹åŒ–æ¸ˆã¿:
- /api/init-db âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
- /api/direct-sql âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
- /api/fix-database âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
- /api/create-sample-data âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
- /api/test-setup âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
- /api/check-table-structure âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
- /api/complete-setup âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
- /api/fix-likes-table âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
- /api/create-likes-table âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
- /api/setup-storage âœ… ç„¡åŠ¹åŒ–æ¸ˆã¿
```

## ğŸ›¡ï¸ **æ¨å¥¨å®Ÿè£…æ‰‹é †**

### Phase 1: ç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œ (1-2æ—¥) âœ… **å®Œäº†**
1. **ç®¡ç†ç”¨APIã®ç„¡åŠ¹åŒ–** âœ…
2. **Supabase Auth ã®å°å…¥** âœ…
3. **åŸºæœ¬çš„ãªRLSãƒãƒªã‚·ãƒ¼ã®å®Ÿè£…** âœ…
4. **ç’°å¢ƒå¤‰æ•°ã®é©åˆ‡ãªè¨­å®š** âœ…

### Phase 2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ– (3-5æ—¥)
1. **å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®èªè¨¼åŒ–**
2. **è©³ç´°ãªRLSãƒãƒªã‚·ãƒ¼ã®å®Ÿè£…**
3. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…**
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„**

### Phase 3: é‹ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (ç¶™ç¶š)
1. **ãƒ­ã‚°ç›£è¦–ã®å®Ÿè£…**
2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ**
3. **å®šæœŸçš„ãªè„†å¼±æ€§ãƒã‚§ãƒƒã‚¯**
4. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥ã®ç¢ºç«‹**

## ğŸ”§ **å…·ä½“çš„ãªå®Ÿè£…ä¾‹**

### 1. APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
```typescript
// middleware/auth.ts
export async function requireAuth(request: NextRequest) {
  const token = request.headers.get('Authorization')?.replace('Bearer ', '')
  
  if (!token) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }
  
  // JWTæ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
  const user = await verifyJWT(token)
  if (!user) {
    return NextResponse.json({ error: 'Invalid token' }, { status: 401 })
  }
  
  return user
}
```

### 2. RLSãƒãƒªã‚·ãƒ¼ä¾‹
```sql
-- articles ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLS
CREATE POLICY "Users can only read published articles" ON articles
  FOR SELECT USING (published = true OR user_id = auth.uid());

CREATE POLICY "Users can only modify their own articles" ON articles
  FOR ALL USING (user_id = auth.uid());
```

### 3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™
```typescript
// lib/rate-limit.ts
import { Ratelimit } from '@upstash/ratelimit'

export const rateLimiter = new Ratelimit({
  redis: /* Redisæ¥ç¶š */,
  limiter: Ratelimit.slidingWindow(10, '60 s'), // 1åˆ†é–“ã«10å›
})
```

## âš ï¸ **ç¾åœ¨ã®ãƒªã‚¹ã‚¯è©•ä¾¡**

- **èªè¨¼**: ğŸ”´ **å±é™º** (ãƒ€ãƒŸãƒ¼å®Ÿè£…)
- **ãƒ‡ãƒ¼ã‚¿ä¿è­·**: ğŸ”´ **å±é™º** (RLSæœªå®Ÿè£…)  
- **API ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ğŸ”´ **å±é™º** (èªè¨¼ãªã—)
- **ç®¡ç†æ©Ÿèƒ½**: ğŸ”´ **å±é™º** (å…¬é–‹çŠ¶æ…‹)

## ğŸ’¡ **æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**

1. **å³åº§ã«å…¬é–‹ã‚’ä¸­æ­¢** ã¾ãŸã¯é–‹ç™ºç’°å¢ƒã§ã®ã¿é‹ç”¨
2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œå®Œäº†å¾Œã«å†å…¬é–‹**
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚é–€å®¶ã«ã‚ˆã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼**ã‚’å®Ÿæ–½
4. **æ®µéšçš„ãƒªãƒªãƒ¼ã‚¹**ã§å®‰å…¨æ€§ã‚’ç¢ºèª

---

**âš ï¸ ç¾åœ¨ã®çŠ¶æ…‹ã§ã®ä¸€èˆ¬å…¬é–‹ã¯éå¸¸ã«ãƒªã‚¹ã‚¯ãŒé«˜ã„ã§ã™ã€‚**
**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œã‚’å„ªå…ˆã—ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚**